### 💡 Liquid Clustering キー選定ガイドライン

#### キー選定の原則

- 原則: Liquid Clustering はフィルタ列での読み取り最適化（データスキッピング）です。キー選定は「よく絞り込みに使う列」を第一優先にしてください。
- GROUP BY キーを提案する場合の注意（次の条件が揃うと間接的にシャッフル効率が改善することがあります）:
  - (1) フィルタにも使う列が、同時に GROUP BY にも登場
    LC により同じキー近傍のレコードが同じファイル/スプリットに偏在しやすくなり、Map 側の部分集約（combiner）が効きやすい。
  - (2) その結果、シャッフルに乗る中間データ量が減る（Shuffle Read/Write 縮小、スピル減）
    ただしグローバル集約のためのシャッフル自体は必要です。
  - (3) キーのカーディナリティが低〜中程度で極端なスキューが少ない
    ファイルごとの「局所的なユニークグループ数」が減り、前述の部分集約効果が出やすい。
- 実務上の推奨: これらの条件を満たさない場合は、常にフィルタ列を優先してください。
